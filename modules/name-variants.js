/**
 * Модуль для роботи з варіантами імен
 * Містить розширений словник зменшувальних форм та різних варіантів написання імен
 */

/**
 * Словник варіантів імен з їхніми стандартними формами
 * Використовується для нормалізації імен до стандартної форми
 * Включає українські зменшувальні імена, російські варіанти імен та додаткові форми
 */
export const nameVariants = {
    // Варіанти українських імен
    'ліза': 'єлизавета',
    'liza': 'єлизавета',
    'lisa': 'єлизавета',
    'лізи': 'єлизавета',
    'єлизавета': 'єлизавета',
    'елизавета': 'єлизавета',
    'lizaveta': 'єлизавета',
    'женя': 'євгеній',
    'жені': 'євгенія',
    'євген': 'євгеній',
    'євгенія': 'євгенія',
    'zhenya': 'євгеній',
    'evgen': 'євгеній',
    'yevhen': 'євгеній',
    'саша': 'олександр',
    'sasha': 'олександр',
    'alex': 'олександр',
    'олесь': 'олександр',
    'шура': 'олександр',
    'санек': 'олександр',
    'саня': 'олександр',
    'аля': 'олександра',
    'леся': 'олександра',
    'оля': 'ольга',
    'olya': 'ольга',
    'наташа': 'наталія',
    'ната': 'наталія',
    'наталя': 'наталія',
    'natasha': 'наталія',
    'діма': 'дмитро',
    'дима': 'дмитро',
    'dima': 'дмитро',
    'dmytryk': 'дмитро',
    'dimon': 'дмитро',
    'міша': 'михайло',
    'миша': 'михайло',
    'мишко': 'михайло',
    'misha': 'михайло',
    'mike': 'михайло',
    'michael': 'михайло',
    'mykhailo': 'михайло',
    'тарас': 'тарас',
    'сергій': 'сергій',
    'сергей': 'сергій',
    'серьожа': 'сергій',
    'сєрожа': 'сергій',
    'сережа': 'сергій',
    'serge': 'сергій',
    'сера': 'сергій',
    'sergio': 'сергій',
    'юра': 'юрій',
    'юрчик': 'юрій',
    'юля': 'юлія',
    'юлія': 'юлія',
    'yulia': 'юлія',
    'yuliya': 'юлія',
    'yura': 'юрій',
    'ігор': 'ігор',
    'ihor': 'ігор',
    'игорь': 'ігор',
    'игор': 'ігор',
    'максим': 'максим',
    'макс': 'максим',
    'max': 'максим',
    'nastya': 'анастасія',
    'настя': 'анастасія',
    'віка': 'вікторія',
    'vika': 'вікторія',
    'victoria': 'вікторія',
    'віталій': 'віталій',
    'віталик': 'віталій',
    'vitaliy': 'віталій',
    'vitalik': 'віталій',
    'олег': 'олег',
    'oleg': 'олег',
    'андрій': 'андрій',
    'andriy': 'андрій',
    'andrey': 'андрій',
    'andy': 'андрій',
    'ваня': 'іван',
    'vanya': 'іван',
    'ivan': 'іван',
    'іван': 'іван',
    'vova': 'володимир',
    'вова': 'володимир',
    'володя': 'володимир',
    'volodya': 'володимир',
    'volod': 'володимир',
    'volodymyr': 'володимир',
    'vladimir': 'володимир',
    'володимир': 'володимир',
    'петро': 'петро',
    'петя': 'петро',
    'petro': 'петро',
    'petya': 'петро',
    'павло': 'павло',
    'павлик': 'павло',
    'паша': 'павло',
    'pasha': 'павло',
    'павел': 'павло',
    'павлуша': 'павло',
    'pavlo': 'павло',
    'влад': 'владислав',
    'vladyslav': 'владислав',
    
    // Додаткові варіанти для жіночих імен
    'галя': 'галина',
    'галина': 'галина',
    'halyna': 'галина',
    'gala': 'галина',
    'таня': 'тетяна',
    'танюша': 'тетяна',
    'тетяна': 'тетяна',
    'tetiana': 'тетяна',
    'tanya': 'тетяна',
    'люда': 'людмила',
    'людмила': 'людмила',
    'liuda': 'людмила',
    'liudmyla': 'людмила',
    'mila': 'людмила',
    'маша': 'марія',
    'марія': 'марія',
    'maria': 'марія',
    'mary': 'марія',
    'masha': 'марія',
    'олександра': 'олександра',
    'alexandra': 'олександра',
    'катя': 'катерина',
    'катюша': 'катерина',
    'катерина': 'катерина',
    'kate': 'катерина',
    'kateryna': 'катерина',
    'валя': 'валентина',
    'валентина': 'валентина',
    'valentyna': 'валентина',
    'іра': 'ірина',
    'ірина': 'ірина',
    'ira': 'ірина',
    'iryna': 'ірина',
    'світлана': 'світлана',
    'світа': 'світлана',
    'svitlana': 'світлана',
    'lana': 'світлана',
    'лариса': 'лариса',
    'лара': 'лариса',
    'larysa': 'лариса',
    'lara': 'лариса',
    'зоя': 'зоя',
    'зоряна': 'зоряна',
    'zoryana': 'зоряна',
    'аня': 'анна',
    'анна': 'анна',
    'anna': 'анна',
    'ann': 'анна',
    'anya': 'анна',
    'ганна': 'ганна',
    'hanna': 'ганна',
    'hannah': 'ганна',
    'неля': 'неля',
    'нелля': 'неля',
    'неллі': 'неля',
    'nelly': 'неля',
    'nelya': 'неля',
    'ніна': 'ніна',
    'nina': 'ніна',
    'інна': 'інна',
    'inna': 'інна',
    'інеса': 'інеса',
    'інесса': 'інеса',
    'inessa': 'інеса',
    'inesa': 'інеса',
    'валерія': 'валерія',
    'лера': 'валерія',
    'лєра': 'валерія',
    'lera': 'валерія',
    'valeria': 'валерія',
    'діана': 'діана',
    'diana': 'діана',
    'маргарита': 'маргарита',
    'марго': 'маргарита',
    'rita': 'маргарита',
    'рита': 'маргарита',
    'marharyta': 'маргарита',
    'margarita': 'маргарита',
    'поліна': 'поліна',
    'полінка': 'поліна',
    'polina': 'поліна',
    'вероніка': 'вероніка',
    'ніка': 'вероніка',
    'veronica': 'вероніка',
    'veronika': 'вероніка',
    'nika': 'вероніка',
    
    // Додаткові варіанти для чоловічих імен
    'костя': 'костянтин',
    'кость': 'костянтин',
    'костік': 'костянтин',
    'костянтин': 'костянтин',
    'kostya': 'костянтин',
    'konstantin': 'костянтин',
    'льоша': 'олексій',
    'олексій': 'олексій',
    'альоша': 'олексій',
    'олеша': 'олексій',
    'леша': 'олексій',
    'алексей': 'олексій',
    'alexei': 'олексій',
    'oleksiy': 'олексій',
    'olexiy': 'олексій',
    'рома': 'роман',
    'ромчик': 'роман',
    'роман': 'роман',
    'roma': 'роман',
    'roman': 'роман',
    'толя': 'анатолій',
    'анатолій': 'анатолій',
    'tolik': 'анатолій',
    'толік': 'анатолій',
    'анатолий': 'анатолій',
    'anatoliy': 'анатолій',
    'anatoly': 'анатолій',
    'валера': 'валерій',
    'валєра': 'валерій',
    'валерій': 'валерій',
    'valera': 'валерій',
    'valeriy': 'валерій',
    'гриша': 'григорій',
    'гріша': 'григорій',
    'григорій': 'григорій',
    'grisha': 'григорій',
    'grigoriy': 'григорій',
    'грицько': 'григорій',
    'степан': 'степан',
    'стьопа': 'степан',
    'стефан': 'степан',
    'стёпа': 'степан',
    'stepan': 'степан',
    'матвій': 'матвій',
    'мотя': 'матвій',
    'матвей': 'матвій',
    'matviy': 'матвій',
    'matthew': 'матвій',
    'нікіта': 'микита',
    'микита': 'микита',
    'nikita': 'микита',
    'mykyta': 'микита',
    'коля': 'микола',
    'микола': 'микола',
    'kolya': 'микола',
    'mykola': 'микола',
    'николай': 'микола',
    'славік': 'в\'ячеслав',
    'славик': 'в\'ячеслав',
    'слава': 'в\'ячеслав',
    'в\'ячеслав': 'в\'ячеслав',
    'viacheslav': 'в\'ячеслав',
    'slava': 'в\'ячеслав',
    'ярик': 'ярослав',
    'ярослав': 'ярослав',
    'yaroslav': 'ярослав',
    'yaryk': 'ярослав',
    'богдан': 'богдан',
    'bohdan': 'богдан',
    'данило': 'данило',
    'данііл': 'данило',
    'даня': 'данило',
    'danya': 'данило',
    'данік': 'данило',
    'danylo': 'данило',
    'daniel': 'данило',
    'денис': 'денис',
    'ден': 'денис',
    'den': 'денис',
    'denys': 'денис',
    'денчик': 'денис',
    'denchyk': 'денис',
    'ростик': 'ростислав',
    'ростислав': 'ростислав',
    'rostyk': 'ростислав',
    'rostyslav': 'ростислав',
    'вітя': 'віктор',
    'витя': 'віктор',
    'вітьок': 'віктор',
    'віктор': 'віктор',
    'vitya': 'віктор',
    'victor': 'віктор',
    'viktor': 'віктор',
    'артем': 'артем',
    'тьома': 'артем',
    'тьомик': 'артем',
    'арсеній': 'арсеній',
    'арсен': 'арсеній',
    'arsen': 'арсеній',
    'arseniy': 'арсеній',
    'сеня': 'арсеній',
    'артьом': 'артем',
    'artem': 'артем',
    'артём': 'артем',
    'артёмка': 'артем',
    'tyoma': 'артем',
    'антон': 'антон',
    'антоша': 'антон',
    'anton': 'антон',
    'tosha': 'антон',
    'антошка': 'антон',
    'філіп': 'пилип',
    'филипп': 'пилип',
    'пилип': 'пилип',
    'philip': 'пилип',
    'pylyp': 'пилип',
    'maks': 'максим',
    'maksym': 'максим',
    'nikita': 'нікіта',
    'mykola': 'микола',
    'nick': 'микола',
    'kolia': 'микола',
    'vladyslav': 'владислав',
    'vlad': 'владислав',
    'vladik': 'владислав',
    'федя': 'федір',
    'федір': 'федір',
    'fedor': 'федір',
    'федор': 'федір',
    'fedia': 'федір'
  };
  
  /**
   * Отримує стандартну форму імені з варіанту
   * @param {string} name - Вхідний варіант імені
   * @returns {string} Стандартизована форма імені
   */
  export function getStandardNameForm(name) {
    if (!name) return '';
    
    const nameLower = name.toLowerCase();
    return nameVariants[nameLower] || nameLower;
  }
  
  /**
   * Перевіряє, чи є ім'я зменшувальною формою іншого імені
   * @param {string} nameVariant - Варіант імені для перевірки
   * @param {string} standardName - Стандартне ім'я
   * @returns {boolean} True, якщо nameVariant є варіантом standardName
   */
  export function isVariantOf(nameVariant, standardName) {
    if (!nameVariant || !standardName) return false;
    
    const variantLower = nameVariant.toLowerCase();
    const standardLower = standardName.toLowerCase();
    
    // Перевірка прямого співпадіння
    if (variantLower === standardLower) return true;
    
    // Перевірка через словник
    const standardForm = getStandardNameForm(variantLower);
    
    // Перевірка з використанням конвертації з російської
    if (standardForm !== variantLower) {
      return standardForm === standardLower;
    }
    
    // Спроба конвертувати з російської, якщо стандартна форма не знайдена
    const ukrainianVariant = russianToUkrainian(variantLower);
    if (ukrainianVariant !== variantLower) {
      const standardFormAfterConversion = getStandardNameForm(ukrainianVariant);
      return standardFormAfterConversion === standardLower;
    }
    
    return false;
  }
  
  /**
   * Перевіряє, чи починається ім'я з певного префіксу
   * Корисно для скорочених імен
   * @param {string} name - Ім'я для перевірки
   * @param {string} prefix - Префікс для пошуку
   * @returns {boolean} True, якщо ім'я починається з префіксу
   */
  export function startsWithPrefix(name, prefix) {
    if (!name || !prefix) return false;
    
    const nameLower = name.toLowerCase();
    const prefixLower = prefix.toLowerCase();
    
    return nameLower.startsWith(prefixLower);
  }
  
  /**
   * Отримує всі можливі стандартні імена для заданого варіанту
   * @param {string} variant - Варіант імені
   * @returns {string[]} Масив можливих стандартних імен
   */
  export function getAllPossibleStandardNames(variant) {
    if (!variant) return [];
    
    const variantLower = variant.toLowerCase();
    const directMatch = nameVariants[variantLower];
    
    if (directMatch) return [directMatch];
    
    // Пошук імен, які можуть бути варіантами за префіксом
    const possibleMatches = [];
    for (const [key, value] of Object.entries(nameVariants)) {
      // Якщо варіант починається з ключа словника або ключ починається з варіанту
      if (variantLower.startsWith(key) || key.startsWith(variantLower)) {
        possibleMatches.push(value);
      }
    }
    
    // Шукаємо схожі імена за допомогою нечіткого співпадіння
    for (const [key, value] of Object.entries(nameVariants)) {
      // Обчислюємо схожість
      const similarity = getSimilarity(variantLower, key);
      if (similarity > 0.7 && !possibleMatches.includes(value)) {
        possibleMatches.push(value);
      }
    }
    
    return [...new Set(possibleMatches)]; // Повертаємо унікальні значення
  }

  /**
   * Функція для обчислення схожості двох рядків
   * @param {string} str1 - Перший рядок
   * @param {string} str2 - Другий рядок
   * @returns {number} Схожість від 0 до 1, де 1 - повне співпадіння
   */
  function getSimilarity(str1, str2) {
    if (!str1 || !str2) return 0;
    
    const len1 = str1.length;
    const len2 = str2.length;
    
    if (len1 === 0 || len2 === 0) return 0;
    
    // Матриця для динамічного програмування
    const matrix = Array(len1 + 1).fill().map(() => Array(len2 + 1).fill(0));
    
    // Ініціалізуємо першу колонку та рядок
    for (let i = 0; i <= len1; i++) matrix[i][0] = i;
    for (let j = 0; j <= len2; j++) matrix[0][j] = j;
    
    // Заповнюємо матрицю
    for (let i = 1; i <= len1; i++) {
      for (let j = 1; j <= len2; j++) {
        const cost = str1[i - 1] === str2[j - 1] ? 0 : 1;
        
        matrix[i][j] = Math.min(
          matrix[i - 1][j] + 1,      // видалення
          matrix[i][j - 1] + 1,      // вставка
          matrix[i - 1][j - 1] + cost // заміна
        );
      }
    }
    
    // Обчислюємо схожість
    return 1 - (matrix[len1][len2] / Math.max(len1, len2));
  }

  /**
   * Конвертує російські символи в українські
   * @param {string} text - Текст для конвертації
   * @returns {string} Текст з заміненими символами
   */
  export function russianToUkrainian(text) {
    if (!text) return '';
    
    const replacements = {
      'ы': 'и',
      'э': 'е',
      'ё': 'йо',
      'ъ': '',
      'ьё': 'ьо',
      'ьи': 'ьі'
    };
    
    let result = text;
    for (const [rus, ukr] of Object.entries(replacements)) {
      result = result.replace(new RegExp(rus, 'g'), ukr);
    }
    
    return result;
  }